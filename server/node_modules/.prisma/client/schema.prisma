// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())

  profile Profile?

  sentLikes     Like[] @relation("SentLikes")
  receivedLikes Like[] @relation("ReceivedLikes")

  matchesAsUser1 Match[] @relation("MatchUser1")
  matchesAsUser2 Match[] @relation("MatchUser2")

  availabilitySlots AvailabilitySlot[]

  proposedInvites CallInvite[]

  reportsMade     BlockReport[] @relation("Reporter")
  reportsReceived BlockReport[] @relation("Target")
}

model Profile {
  id          Int     @id @default(autoincrement())
  displayName String
  bio         String?
  age         Int
  location    String?
  gender      String?
  preferences String? // JSON string

  userId Int  @unique
  user   User @relation(fields: [userId], references: [id])

  photos Photo[]
}

model Photo {
  id        Int     @id @default(autoincrement())
  url       String
  sortOrder Int     @default(0)
  isPrimary Boolean @default(false)

  profileId Int
  profile   Profile @relation(fields: [profileId], references: [id])
}

model Like {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  senderId Int
  sender   User @relation("SentLikes", fields: [senderId], references: [id])

  receiverId Int
  receiver   User @relation("ReceivedLikes", fields: [receiverId], references: [id])

  @@unique([senderId, receiverId])
}

model Match {
  id        Int      @id @default(autoincrement())
  matchedAt DateTime @default(now())
  isActive  Boolean  @default(true)

  user1Id Int
  user1   User @relation("MatchUser1", fields: [user1Id], references: [id])

  user2Id Int
  user2   User @relation("MatchUser2", fields: [user2Id], references: [id])

  invites CallInvite[]

  @@unique([user1Id, user2Id])
}

model AvailabilitySlot {
  id        Int      @id @default(autoincrement())
  startTime DateTime
  endTime   DateTime
  isBooked  Boolean  @default(false)

  userId Int
  user   User @relation(fields: [userId], references: [id])

  invites CallInvite[]
}

model CallInvite {
  id        Int      @id @default(autoincrement())
  status    String   @default("pending") // pending, accepted, declined, expired
  createdAt DateTime @default(now())

  matchId Int
  match   Match @relation(fields: [matchId], references: [id])

  proposerId Int
  proposer   User @relation(fields: [proposerId], references: [id])

  slotId Int
  slot   AvailabilitySlot @relation(fields: [slotId], references: [id])

  booking CallBooking?
}

model CallBooking {
  id            Int      @id @default(autoincrement())
  scheduledTime DateTime
  status        String   @default("scheduled") // scheduled, completed, canceled
  meetingLink   String?

  inviteId Int        @unique
  invite   CallInvite @relation(fields: [inviteId], references: [id])
}

model BlockReport {
  id        Int      @id @default(autoincrement())
  type      String // block, report
  reason    String?
  createdAt DateTime @default(now())

  reporterId Int
  reporter   User @relation("Reporter", fields: [reporterId], references: [id])

  targetId Int
  target   User @relation("Target", fields: [targetId], references: [id])
}
